spring:
  application:
    name: mod-search
  mustache:
    check-template-location: false
  jackson:
    default-property-inclusion: non_null
    deserialization:
      fail-on-unknown-properties: false
      accept-single-value-as-array: true
  elasticsearch:
    username: ${ELASTICSEARCH_USERNAME:}
    password: ${ELASTICSEARCH_PASSWORD:}
    uris: ${ELASTICSEARCH_URL:http://${ELASTICSEARCH_HOST:elasticsearch}:${ELASTICSEARCH_PORT:9200}}
  kafka:
    bootstrap-servers: ${KAFKA_HOST:kafka}:${KAFKA_PORT:9092}
    consumer:
      max-poll-records: 50
    security:
      protocol: ${KAFKA_SECURITY_PROTOCOL:PLAINTEXT}
    ssl:
      key-store-password: ${KAFKA_SSL_KEYSTORE_PASSWORD:}
      key-store-location: ${KAFKA_SSL_KEYSTORE_LOCATION:}
      trust-store-password: ${KAFKA_SSL_TRUSTSTORE_PASSWORD:}
      trust-store-location: ${KAFKA_SSL_TRUSTSTORE_LOCATION:}
  datasource:
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:postgres}
    url: jdbc:postgresql://${DB_HOST:postgres}:${DB_PORT:5432}/${DB_DATABASE:okapi_modules}
  liquibase:
    change-log: classpath:changelog/changelog-master.xml
  jpa:
    open-in-view: false
  cache:
    cache-names:
      - es-indices
      - reference-data-cache
      - tenant-languages
      - tenant-features
    caffeine:
      spec: maximumSize=500,expireAfterAccess=3600s

application:
  environment: ${ENV:folio}
  search-config:
    initial-languages: ${INITIAL_LANGUAGES:eng}
    max-supported-languages: ${MAX_SUPPORTED_LANGUAGES:5}
    search-features:
      search.all.fields: ${SEARCH_BY_ALL_FIELDS_ENABLED:false}
    indexing:
      instance-subjects:
        retry-attempts: ${INSTANCE_SUBJECTS_INDEXING_RETRY_ATTEMPTS:3}
  query:
    properties:
      call-number-browse-optimization-enabled: ${CN_BROWSE_OPTIMIZATION_ENABLED:true}
  cache:
    call-number-browse-ranges-cache-spec: maximumSize=50,expireAfterAccess=300s
  module-user:
    store-type: ${MODULE_USER_STORE_TYPE:ephemeral}
    cache-capacity: ${MODULE_USER_CACHE_CAPACITY:100}
    cache-ttl-ms: ${MODULE_USER_CACHE_TTL_MS:3600000}
    failure-cache-ttl-ms: ${MODULE_USER_FAILURE_CACHE_TTL_MS:30000}
    ephemeral:
      credentials: ${MODULE_USER_EPHEMERAL_CREDENTIALS:}
    aws-ssm:
      region: ${MODULE_USER_AWS_SSM_REGION:}
      use-iam: ${MODULE_USER_AWS_SSM_USE_IAM:true}
      ecs-credentials-endpoint: ${MODULE_USER_AWS_SSM_ECS_CREDENTIALS_ENDPOINT:}
      ecs-credentials-path: ${MODULE_USER_AWS_SSM_ECS_CREDENTIALS_PATH:}
    vault:
      token: ${MODULE_USER_VAULT_TOKEN:}
      address: ${MODULE_USER_VAULT_ADDRESS:}
      enable-ssl: ${MODULE_USER_VAULT_ENABLE_SSL:false}
      pem-file-path: ${MODULE_USER_VAULT_PEM_FILE_PATH:}
      keystore-password: ${MODULE_USER_VAULT_KEYSTORE_PASSWORD:}
      keystore-file-path: ${MODULE_USER_VAULT_KEYSTORE_FILE_PATH:}
      truststore-file-path: ${MODULE_USER_VAULT_TRUSTSTORE_FILE_PATH:}
  stream-ids:
    scroll-query-size: ${SCROLL_QUERY_SIZE:1000}
    retry-interval-ms: ${STREAM_ID_RETRY_INTERVAL_MS:1000}
    retry-attempts: ${STREAM_ID_RETRY_ATTEMPTS:3}
  kafka:
    retry-interval-ms: ${KAFKA_RETRY_INTERVAL_MS:2000}
    retry-delivery-attempts: ${KAFKA_RETRY_DELIVERY_ATTEMPTS:6}
    listener:
      events:
        concurrency: ${KAFKA_EVENTS_CONCURRENCY:2}
        topic-pattern: ${KAFKA_EVENTS_CONSUMER_PATTERN:(${application.environment}\.)(.*\.)inventory\.(instance|holdings-record|item|bound-with)}
        group-id: ${application.environment}-mod-search-events-group
      authorities:
        concurrency: ${KAFKA_AUTHORITIES_CONCURRENCY:1}
        topic-pattern: ${KAFKA_AUTHORITIES_CONSUMER_PATTERN:(${application.environment}\.)(.*\.)inventory\.authority}
        group-id: ${application.environment}-mod-search-authorities-group

server.port: 8081
management.endpoints.web:
  base-path: /admin
  exposure.include: info,health,liquibase,threaddump,heapdump
